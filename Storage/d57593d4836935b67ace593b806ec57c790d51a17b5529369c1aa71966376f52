et += l;
      } else {
        ok = false;
      }
    }
    return ok;
  };

  while (offset < end_offset && !is_shutting_down()) {
    if (!strm.is_writable()) {
      error = Error::Write;
      return false;
    } else if (!content_provider(offset, end